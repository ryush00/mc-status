function reorderServers(){var a=$("table tbody tr");a.sort(function(a,b){var a=$("> .serverPlayers",a).attr("data-players"),b=$("> .serverPlayers",b).attr("data-players");return b-a}),a.each(function(a,b){$("> td",b).first().text(a+1)}),$("table tbody").append(a)}function renderPage(a){startUpdate(),$.each($("#mojang-status .alert"),function(a,b){$(b).html("Fetching status for <b>"+$(b).attr("data-name")+"</b>")}),updateMojangServices(),$("[rel='tooltip']").tooltip(),chart=new CanvasJS.Chart("chart",a),doRender(chart),$(".nav li a").click(function(a){a.preventDefault(),$(this).tab("show");for(var b=0;b<chart.options.data.length;b++)chart.options.data[b].type=$(a.target).attr("data-name");doRender(chart)})}function doRender(a){a.render(),$(".canvasjs-chart-credit").remove()}var chart=null,updateIn=-1,startUpdate=function(){updateIn--<=0&&(updateIn=30);var a="Updating in "+updateIn+" second";0==updateIn?(a="Updating all data now",updateServers(),updateMojangServices()):1!=updateIn&&(a+="s"),$("h2 small").text(a),setTimeout(startUpdate,1e3)},updateServers=function(){$.getJSON("./api/servers",function(a){null!==chart&&$.each(a,function(a,b){$.each(chart.options.data,function(a,c){if(c.name===b.name){var d=[];$.each(b.pings,function(a,b){d.push({label:c.name,x:b.queryTime,y:b.players})}),c.dataPoints=d}})}),$.each(a,function(a,b){var c=$("table tbody td.serverName:contains('"+b.name+"')").parent(),d=b.pings[b.pings.length-1],e=d.players,f=d.maxPlayers,g=b.name+" has ",h=$("> td.serverPlayers span.glyphicon",c);e>b.pings[0].players?(g+="gained ",h.addClass("glyphicon-arrow-up"),h.removeClass("glyphicon-arrow-down")):(g+="lost ",h.addClass("glyphicon-arrow-down"),h.removeClass("glyphicon-arrow-up")),g+=Math.abs(e-b.pings[0].players)+" players over the last 24 hours.",$("> td.serverPlayers span.text",c).text(e+" / "+f),$("> td.serverPlayers",c).attr("data-original-title",g),$("> td.serverPlayers",c).attr("data-players",e)}),doRender(chart),reorderServers()})},updateMojangServices=function(){$.getJSON("./api/services",function(a){$.each($("#mojang-status .alert"),function(b,c){{var d,e=$(c).attr("data-service"),f=a[e],g=$(c).attr("data-name");f.bootstrapClass}switch(f.status){case"green":d="online";break;case"yellow":d="having problems";break;case"red":d="offline"}$(c).html(g+" is <b>"+d+"</b>"),$(c).removeClass(),$(c).addClass("alert"),$(c).addClass(f.bootstrapClass)})})};